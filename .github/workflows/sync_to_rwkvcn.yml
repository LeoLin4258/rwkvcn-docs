name: Sync Pages and Components Directory to RWKVCN

on:
  push:
    branches:
      - main  # 监听 RWKVCN-DOCS 仓库的 main 分支

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout RWKVCN-DOCS repo
        uses: actions/checkout@v2

      - name: Sync Directories to RWKVCN
        env:
          PERSONAL_ACCESS_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}  # 在 RWKVCN-DOCS 的 Secrets 中配置 PAT
        run: |
          # 克隆 RWKVCN 仓库的 docs 分支
          git clone --branch docs https://$PERSONAL_ACCESS_TOKEN@github.com/LeoLin4258/rwkvcn.git rwkvcn

          # 使用 rsync 将 RWKVCN-DOCS 仓库的 pages 目录和 components/docs/ 目录同步到 RWKVCN 仓库
          rsync -av --delete --exclude='.git' pages/ rwkvcn/pages/
          rsync -av --delete --exclude='.git' components/docs/ rwkvcn/components/docs/

          # 提交并推送更新到 RWKVCN 的 docs 分支
          cd rwkvcn

          # 检查是否存在 rwkvcn-docs 分支，如果不存在则创建
          if [ "$(git branch --list rwkvcn-docs)" ]; then
              git checkout rwkvcn-docs
          else
              git checkout -b rwkvcn-docs
          fi

          # 配置 Git 用户信息
          git config user.name "github-actions[sync-docs]"
          git config user.email "github-actions[sync-docs]@users.noreply.github.com"

          git add pages/ components/docs/
          git commit -m "Sync pages and components/docs directories from RWKVCN-DOCS main to rwkvcn-docs"
          git push origin rwkvcn-docs
