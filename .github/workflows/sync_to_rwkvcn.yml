name: Sync Pages Directory to RWKVCN

on:
  push:
    branches:
      - main  # Listen to changes on the main branch of RWKVCN-DOCS

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout RWKVCN-DOCS repo
        uses: actions/checkout@v2

      - name: Sync Pages Directory to RWKVCN
        env:
          PERSONAL_ACCESS_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}  # PAT configured in RWKVCN-DOCS secrets
        run: |
          # Clone the rwkvcn-docs branch from RWKVCN repository
          git clone --branch rwkvcn-docs https://$PERSONAL_ACCESS_TOKEN@github.com/LeoLin4258/rwkvcn.git rwkvcn

          # Sync pages directory from RWKVCN-DOCS to RWKVCN repository
          rsync -av --delete --exclude='.git' pages/ rwkvcn/pages/

          # Commit and push the changes to rwkvcn-docs branch in RWKVCN
          cd rwkvcn

          # Configure Git user info for the commit
          git config user.name "github-actions[sync-docs]"
          git config user.email "github-actions[sync-docs]@users.noreply.github.com"

          git add pages/
          git commit -m "Sync pages directory from RWKVCN-DOCS main to rwkvcn-docs" || echo "No changes to commit"
          git push origin rwkvcn-docs
